# Nginx configuration for OAuth2 React frontend
# This file tells Nginx how to serve your React app and connect to your Spring Boot backend

server {
    # Listen on port 80 (standard web port)
    listen 80;
    
    # Server name (localhost for development)
    server_name localhost;
    
    # Where your React build files are stored in the container
    root /usr/share/nginx/html;
    
    # The main HTML file React creates
    index index.html;

    # ===========================================
    # REACT ROUTER - HANDLES YOUR APP PAGES
    # ===========================================
    # This is the most important part for React!
    # When someone visits /login, /profile, /dashboard, etc.
    # Nginx serves index.html and React Router handles the rest
    location / {
        try_files $uri $uri/ /index.html;
    }

    # ===========================================
    # CONNECT TO YOUR SPRING BOOT BACKEND
    # ===========================================
    # When your React app makes API calls like:
    # - /api/auth/login
    # - /api/users/profile
    # - /api/auth/verify
    # Nginx forwards them to your Spring Boot backend
    location /api/ {
        # Send requests to your backend container
        # 'backend' is the name of your Spring Boot service in docker-compose
        proxy_pass http://backend:8080;
        
        # Pass along important information to the backend
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ===========================================
    # SPRING BOOT HEALTH CHECKS
    # ===========================================
    # Your Spring Boot app has health check endpoints
    # These help Docker know if your backend is working
    location /actuator/ {
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ===========================================
    # MAKE YOUR APP LOAD FASTER
    # ===========================================
    # Cache CSS, JavaScript, and image files
    # This makes your app load faster on repeat visits
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        # Cache files for 1 year (they rarely change)
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ===========================================
    # SECURITY - PROTECT YOUR APP
    # ===========================================
    # Add security headers to prevent attacks
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # ===========================================
    # COMPRESSION - MAKE FILES SMALLER
    # ===========================================
    # Compress files to make them load faster
    gzip on;
    gzip_vary on;
    gzip_types
        text/plain
        text/css
        text/javascript
        application/json
        application/javascript;

    # ===========================================
    # HANDLE 404 ERRORS
    # ===========================================
    # If a page doesn't exist, serve index.html
    # This lets React Router handle the routing
    error_page 404 /index.html;
    
    # ===========================================
    # FILE UPLOAD SIZE
    # ===========================================
    # Allow file uploads up to 10MB (for profile pictures, etc.)
    client_max_body_size 10M;
}
